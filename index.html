<!-- ... head and styles unchanged ... -->

<script>
// ... SHEET_URL and TRAINING_RULES unchanged ...

function isRequiredForRole(topic, role) {
  const rule = TRAINING_RULES[topic];
  if (!rule) return false;
  const r = (role || '').trim().toLowerCase();
  if (rule === "All Required") return true;
  if (rule === "Field Required") return r === "field" || r === "foreman";
  if (rule === "Foreman") return r === "foreman";
  if (rule === "Office") return r === "office";
  return false;
}

// ... parseTextDate, normalizeName, badge, daysLeftStyle unchanged ...

async function buildData() {
  records = await loadData();
  if (!records.length) return;

  topicMap = {}; employeeMap = {}; allOverdue = [];
  let overdueCount = 0, overdueEmps = new Set();

  records.forEach(r => {
    let topic = r['Topic']?.trim();
    if (topic === "Fall Protection Awareness") topic = "Fall Protection";
    if (topic === "SpecialtyConfined Space") topic = "Confined Space";

    const origName = r['Employee Name']?.trim();
    const normName = normalizeName(origName);
    const roleRaw = r['Role']; // keep raw for debug
    const role = (roleRaw || '').trim(); // this should be "Foreman"

    // Debug: log Will Tuttle specifically
    if (origName === "Will Tuttle" || normName.includes("tuttle")) {
      console.log(`Will Tuttle row → Role raw: "${roleRaw}" | trimmed: "${role}" | normName: "${normName}"`);
    }

    if (!normName || !topic) return;

    if (!employeeMap[normName]) {
      employeeMap[normName] = { original: origName, role, records: {} };
    }
    employeeMap[normName].records[topic] = r;

    // ... rest of topicMap and overdue counting unchanged ...
  });

  // ... missing required flagging, overdue banner update, renderTopics, populateEmployeeDropdown unchanged ...
}

// In showEmployeeDetail – improve display
function showEmployeeDetail(norm) {
  const emp = employeeMap[norm];
  if (!emp) return;

  const name = emp.original;
  let roleDisplay = emp.role ? emp.role.charAt(0).toUpperCase() + emp.role.slice(1).toLowerCase() : 'Unknown';
  // Debug: log what we display
  if (name === "Will Tuttle") {
    console.log(`Displaying Will Tuttle → Role: "${roleDisplay}" (from stored: "${emp.role}")`);
  }

  let html = `<div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h4>${name}</h4>
        <div class="text-muted">Role: ${roleDisplay}</div>
      </div>
      <!-- ... buttons unchanged ... -->
    </div>
    <!-- ... rest of html, addSection calls unchanged ... -->
  `;
  // ... rest unchanged ...
}

// ... other functions (showTopicDetail, showAllOverdue, exportPDF, openOutlookEmail) unchanged ...
</script>
